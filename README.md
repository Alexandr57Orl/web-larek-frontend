# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Данные и типы данных, используемые в приложении

### Интерфейс для карточки товара

```

export interface IItemsProduct {
id: string; // идентификатор карточки
description: string; // описание карточки
image: string; // ссылка на изображение
title: string; // название товара
category: Tcategory; // категория товара
price: number; // цена товара
}
```

### Интерфейс открытой для просмотра карточки товара

```
export interface ICardsData {
produts: IItemsProduct[]; // массив карточек
show: string | null; // указатель на ту карточку, которую мы хотим просмотреть
}
```

### Интерфейс для модели данных об пользователе

```
export interface IUserData {
email: string; // почта
mobile: string; // телефон
adress: string; // адрес
typePay: ChoicePay; // выбранный способ оплаты
getUserData: IUserData; // данные пользователя
}
```

### Интерфейс для каталога товара

```
export interface ICatalog {
products: IItemsProduct[]; // массив карточек
show: string | null; // указатель на ту карточку, которую мы хотим просмотреть
getCatalog: ICatalog;
showOneItem(item: string): void; //открываем карточку для просмотра по id
getItemsProduct(): IItemsProduct[]; //получаем массив карточек с сервера
saveItemsProduct(): IItemsProduct[]; //сохраняем массив карточек
}
```

### Интерфейс для корзины

```
export interface IBasket {
items: IItemsProduct[]; // карточки в корзине
add(id: string): void; // добавить карточку в корзину
remove(id: string): void; // удалить карточку из корзины
resetBasket(): void; // очистить корзину
}
```

### Интерфейс для заказа

```
export interface IResOred {
typePay: ChoicePay; // тип оплаты
adress: string; // адрес доставки
email: string; // почта
mobile: string; // телефон
items: IItemsProduct[]; // массив карточек
total: number | null; // итого, что находится в корзине
}
```

# Общие типы для приложения

### Принимаемый тип данных для опции выбора способа оплаты

```
export type ChoicePay = 'card' | 'cash';
```

### Принимаемый тип данных для категории товара

```
export type Tcategory =
	| 'софт-скилл'
	| 'другое'
	| 'дополнительное'
	| 'кнопка'
	| 'хард-скилл';
```

## Работа с типом данных модального окна

### Принимаемый тип данных для модального окна со способом оплаты

```
export type IPaymentModal = Pick<IUserData, `adress`>;
```

### Принимаемый тип данных для модального окна с информацией о пользователе

```
export type IUserModal = Pick<IUserData, `email` | `mobile`>;
```

### Принимаемый тип данных для модального окна с информацией о успешном совершении заказа

```
export type IOrderSuccessPopup = Pick<IResOred, 'total'>;
```

### Принимаемый тип данных для отображения добавленного товара(карточки) в корзине

```
export type IPopupItemInBacket = Pick<IItemsProduct, 'title' | 'price'>;
```

# Архитектура приложения

## Код приложения разделен на слои согласно парадигме MVP:

- _слой представления_, `View`отвечает за отображение данных пользователю и взаимодействие с пользователем. Оно получает данные, которые необходимо отобразить, от Presenter'а и просто реализует логику их визуализации, без ведения каких-либо операций над данными.
- _слой данных_, `Model` Модель отвечает за бизнес-логику приложения, управление данными и операции с данными, такие как загрузка, сохранение и изменение данных. Модель не зависит от пользовательского интерфейса и не содержит логику отображения, что делает ее переиспользуемой в различных интерфейсах.

- _презентер_,`Presenter` отвечает за управление логикой приложения и обмен данными между моделью (Model) и представлением (View).

## Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

`constructor(baseUrl: string, options: RequestInit = {})` - принимает базовый URL и глобальные опции для всех запросов(опционально).

Реализует логику работы с сервером. Содержит конструктор для создания объекта со свойствами базового url адреса и хэдеров запроса. Также содержит `get` и `post` методы.

`get` - _выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер_

`post` - _принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове._

## Класс `EventEmitter`

Данный класс - является брокером событий, который позволяет отправлять события, а также подписываться на события, происходящие в системе. Конструктор создает пустой объект `Map`, который будет хранить события и их подписчиков. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

## Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

метод `on` - Установливает обработчик на событие;

метод `of` - Снимает обработчик с события;

метод `emit` - Инициирует событие с данными;

метод `onAll` - Устанавливает слушатель на все события;

метод `offAll` - удаляет все обработчики для всех событий;

метод `trigger` - создает и возвращает функцию-триггер, которая в свою очередь генерирует событие с указанным именем и данными.

# Слой данных `Model`

## Класс UserDate

Данный класс отвечает за данные пользователя и логику работы с этими данными.
Функция-конструктор принимает инстанс брокера событий
Содержит следующие поля:

```
    _email: string; // хранит данные почты пользователя
	_mobile: string; // хранит данные телефона пользователя
	_adress: string; // хранит адрес пользователя
	_typePay: ChoicePay; // хранит выбранный способ оплаты пользователя
```

Класс UserDate также имеет следующие методы:

```
getUserData(): IUserData // возвращает объект с данными пользователя

функция get() - для доступа и set() - для работы со свойствами объекта-инстанса этого класса
```

## Класс ItemsProductsDate

Класс отвечает за хранение и логику работы с данными карточки продукта.
Конструктор класса принимает инстант брокера событий.
В полях класса хранятся следующие данные:

```
_products:IItemsProducts[] - хранит массив карточек
_show: string | null - указатель на ту карточку, которую мы хотим просмотреть
```

### Методы класса для взаимодействия с данными:

    showOneItem(item: string): void; - открываем карточку для просмотра по id;
    getItemsProduct(): IItemsProducts[]; - получаем массив карточек с сервера;
    saveItemsProduct(): IItemsProducts[]; - сохраняем массив карточек;
    функции get(), set(); для доступа и работы со свойствами объекта-инстанса этого класса

## Класс ResOrderDate

Класс ResOrderDate отвечает за обработку данных заказа. Он принимает инстанс брокера событий в своем конструкторе. Он имеет следующие поля:

```
	_typePay: ChoicePay; - тип оплаты
	_adress: string; - адрес доставки
	_email: string; - почта
	_mobile: string; - телефон
	_items: IItemsProducts[]; - массив карточек
	_total: number | null; - итого, что находится в корзине
```

### Методы класса для взаимодействия с данными:

`get() - для доступа и set() - для работы со свойствами этого класса.`

## Класс BasketDate

Этот класс отвечает за управление содержимым корзины покупок. В его конструкторе передается экземпляр брокера событий.

```
_items: IItemsProducts[] - массив объектов, представляющих товары в корзине. Каждый объект имеет свойства
_total: number | null; - итого, что находится в корзине
```

### Методы класса для взаимодействия с данными

```
get() - для доступа и set() - для работы со свойствами этого класса.

add(id: string): void - метод для добавления товара в корзину. Принимает id товара в виде строки и не возвращает значения.

remove(id: string): void - метод для удаления товара из корзины. Принимает id товара в виде строки и не возвращает значения.

resetBasket(): void - метод для очистки корзины. Не принимает аргументов и не возвращает значения.
```

# Слой представления `View`

### Данный слой используется для представления данных на экране.

## Класс `Card`

```
Это класс, отвечающий за отображение карточек на главной странице, в модальном окне просмотра карточки и в корзине.
В конструкторе класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.
В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.
Поля класса содержат элементы разметки карточки.
Конструктор, кроме темплейта, принимает экземпляр EventEmitter для инициации событий.
```

## Класс `Page`

```
Этот класс управляет показом блока карточек на стартовой странице. Конструктору передаётся контейнер для размещения карточек. Метод render использует предоставленный массив элементов карточек для их отображения в заданном контейнере.
```

# Слой `Presenter` отвечающий за взаимодействие компнонетов

Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и их обработчиков описанных в events.ts
В events.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

Список событий, которые могут генерироваться в системе:

```
-cardsItems:changed - изменение массива карточек товаров.

-basket:open- открытие модального окна с содержимым корзины.

-basketData:changed - изменение данных в корзине товаров

-userInfoUpgrade - изменение данных о пользователе (adress,mobile,email)
```

### События, при взаимодействии пользователя с интерфейсом

```
-mobile:input - ввод телефона клиента.

-email:input - ввод почтового адреса клиента.

-address:input - ввод адреса доставки заказа.

-order:submit - подтверждение данных для оплаты и доставки.

-contacts:submit - подтверждение контактных данных.

-card:delete - удаление товара из корзины

-choice-pay: change - выбор оплаты

-order:complete - при открытии окна успешной оплаты
```
